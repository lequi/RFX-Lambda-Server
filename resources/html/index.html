<!DOCTYPE html>
<html>
<head>

<meta charset="utf-8" />

<title>Reactive Spark SQL Query Demo</title>

<link href="https://monitor.adsplay.net/css/bootstrap.min.css">

<style>
body {
	padding: 20px;
}

#console {
	height: 400px;
	overflow: auto;
}

.username-msg {
	color: orange;
}

.connect-msg {
	color: green;
}

.disconnect-msg {
	color: red;
}

.send-msg {
	color: #888
}

.result {
	font-weight: bold;
	color: blue;
}
</style>


<script src="http://chat.socket.io/socket.io/socket.io.js"></script>
<script src="https://monitor.adsplay.net/js/moment.min.js"></script>
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>

</head>

<body>

	<h1>Reactive Spark SQL Query Demo</h1>

	<br />

	<div id="console" class="well"></div>

	<form class="well form-inline" onsubmit="return false;">
		<input id="msg" class="input-xlarge" type="text"
			placeholder="Type a SQL query here..." />
		<button type="button" onClick="sendMessage()" class="btn">Send</button>
		<button type="button" onClick="sendDisconnect()" class="btn">Disconnect</button>
	</form>

<script>
	var senderId = 'sender:' + Math.floor((Math.random() * 10000) + 1);

	var socket = io.connect('http://localhost:9092');

	socket.on('connect',function() {output('<span class="connect-msg">Client has connected to the server!</span>');	});

	socket.on('queryResult',function(data) {		
		var rs = JSON.parse(data.jsonData);
		console.log(rs);
		output('<span class="result">' + rs.ok + '</span> '); 
	});

	socket.on('disconnect', function() { output('<span class="disconnect-msg">The client has disconnected!</span>'); });

	function sendDisconnect() {
		socket.disconnect();
	}

	function sendMessage() {
		var queryStr = $('#msg').val();
		$('#msg').val('');
		
		var q = { senderId : senderId, query : queryStr };		
		socket.emit('queryEvent', q);
		
		output('<span class="username-msg">' + q.senderId + ':</span> '+ q.query); 
	}

	function output(message) {
		var currentTime = "<span class='time'>"	+ moment().format('HH:mm:ss.SSS') + "</span>";
		var element = $("<div>" + currentTime + " " + message + "</div>");
		$('#console').append(element);
	}
	
	$("#msg").keyup(function(event){
	    if(event.keyCode == 13){
	    	sendMessage();
	    }
	});
</script>

</body>

</html>